<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <link rel="stylesheet" href="./styles/css/styles.css" />
  </head>

  <body>
    <div class="wrapper-full">
      <div class="container-persons-cards">
        <div class="container-cards">
          <div class="card-person">
            <div class="container-person-data">
              <div class="content-user-image">
                <div class="content-img">
                  <img
                    class="user-img"
                    id="photo-alumno-t1"
                    src="img/user.png"
                    alt=""
                  />
                </div>
                <div class="item-data-user">
                  <p class="data-value" id="name-alumno-t1">Nombre</p>
                  <p class="data-value" id="input-Matricula-t1">Matricula</p>
                </div>
              </div>
              <div class="content-user-data" id="data-user-t1">
                <div class="item-data-user">
                  <p class="data-value">Permiso</p>
                  <p class="data-value" id="input-Permiso-t1">cargando..</p>
                </div>
                <div class="item-data-user">
                  <p class="data-value">Residencia</p>
                  <p class="data-value" id="input-Residencia-t1">cargando..</p>
                </div>
                <div class="item-data-user">
                  <p class="data-value">Estado</p>
                  <p class="data-value" id="input-Estado-t1">cargando..</p>
                </div>
                <div class="item-data-user">
                  <p class="data-value">Facultad</p>
                  <p class="data-value" id="input-Facultad-t1">cargando..</p>
                </div>
                <div class="item-data-user">
                  <p class="data-value">Carrerar</p>
                  <p class="data-value" id="input-Carrera-t1">cargando..</p>
                </div>
              </div>
            </div>
            <div class="container-numer-gate">
              Torniquete 1
            </div>
          </div>
          <div class="card-person">
            <div class="container-person-data">
              <div class="content-user-image">
                <div class="content-img">
                  <img
                    class="user-img"
                    id="photo-alumno-t2"
                    src="img/user.png"
                    alt=""
                  />
                </div>
                <div class="item-data-user">
                  <p class="data-value" id="name-alumno-t2">Nombre</p>
                  <p class="data-value" id="input-Matricula-t2">Matricula</p>
                </div>
              </div>
              <div class="content-user-data" id="data-user-t2">
                    <div class="item-data-user">
                            <p class="data-value">Permiso</p>
                            <p class="data-value" id="input-Permiso-t2">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Residencia</p>
                            <p class="data-value" id="input-Residencia-t2">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Estado</p>
                            <p class="data-value" id="input-Estado-t2">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Facultad</p>
                            <p class="data-value" id="input-Facultad-t2">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Carrerar</p>
                            <p class="data-value" id="input-Carrera-t2">cargando..</p>
                          </div>
              </div>
            </div>
            <div class="container-numer-gate">
              Torniquete 2
            </div>
          </div>
          <div class="card-person">
            <div class="container-person-data">
              <div class="content-user-image">
                <div class="content-img">
                  <img
                    class="user-img"
                    id="photo-alumno-t3"
                    src="img/user.png"
                    alt=""
                  />
                </div>
                <div class="item-data-user">
                  <p class="data-value" id="name-alumno-t3">Nombre</p>
                  <p class="data-value" id="input-Matricula-t3">Matricula</p>
                </div>
              </div>
              <div class="content-user-data" id="data-user-t3">
                    <div class="item-data-user">
                            <p class="data-value">Permiso</p>
                            <p class="data-value" id="input-Permiso-t3">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Residencia</p>
                            <p class="data-value" id="input-Residencia-t3">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Estado</p>
                            <p class="data-value" id="input-Estado-t3">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Facultad</p>
                            <p class="data-value" id="input-Facultad-t3">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Carrerar</p>
                            <p class="data-value" id="input-Carrera-t3">cargando..</p>
                          </div>
              </div>
            </div>
            <div class="container-numer-gate">
              Torniquete 3
            </div>
          </div>
          <div class="card-person">
            <div class="container-person-data">
              <div class="content-user-image">
                <div class="content-img">
                  <img
                    class="user-img"
                    id="photo-alumno-bandera"
                    src="img/user.png"
                    alt=""
                  />
                </div>
                <div class="item-data-user">
                  <p class="data-value" id="name-alumno-bandera">Nombre</p>
                  <p class="data-value" id="input-Matricula-bandera">
                    Matricula
                  </p>
                </div>
              </div>
              <div class="content-user-data" id="data-user-bandera">
                    <div class="item-data-user">
                            <p class="data-value">Permiso</p>
                            <p class="data-value" id="input-Permiso-bandera">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Residencia</p>
                            <p class="data-value" id="input-Residencia-bandera">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Estado</p>
                            <p class="data-value" id="input-Estado-bandera">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Facultad</p>
                            <p class="data-value" id="input-Facultad-bandera">cargando..</p>
                          </div>
                          <div class="item-data-user">
                            <p class="data-value">Carrerar</p>
                            <p class="data-value" id="input-Carrera-bandera">cargando..</p>
                          </div>
              </div>
            </div>
            <div class="container-numer-gate">
              Torniquete 4
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      var torn1RegBefore = '';
      var torn2RegBefore = '';
      var torn3RegBefore = '';
      var banderaBefore = '';
      var updateViews = [0,0,0,0];

      var tipoPerson = 'sd';

      $(document).ready(function () {
          function updateView(codeP,updateViews) {
              codeP =  jQuery.parseJSON(codeP);
              if(updateViews[0] == 1){
                  $.ajax({
                  url:"/lastRegistro/{{$EntradaLoc==''?'ARCO_PRINCIPAL':$EntradaLoc}}/"+ codeP.Data[0].torn1Reg,
                  dataType : 'text',
                  success: function (response) {
                      var resp = jQuery.parseJSON(response);
                      var tipoPerson = resp.Data.tipo_persona;
                      if(tipoPerson == 'ALUMNO'){
                          $("#data-user-t1").html('<div class="item-data-user">'+
                              '<p class="data-value">Permiso</p>'+
                              '<p class="data-value" id="input-Permiso-t1">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Residencia</p>'+
                              '<p class="data-value" id="input-Residencia-t1">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Estado</p>'+
                              '<p class="data-value" id="input-Estado-t1">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Facultad</p>'+
                              '<p class="data-value" id="input-Facultad-t1">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Carrerar</p>'+
                              '<p class="data-value" id="input-Carrera-t1">cargando..</p>'+
                              '</div>');

                              $("#photo-alumno-t1").attr("src","https://academico.um.edu.mx/academico/foto?Codigo=" + resp.Data.codigo_personal);
                              $("#name-alumno-t1").html(resp.Data.nombre);
                              $("#input-Matricula-t1").html(resp.Data.codigo_personal);
                              $("#input-Residencia-t1").html(resp.Data.residencia);
                              $("#input-Estado-t1").html(resp.Data.status);
                              $("#input-Carrera-t1").html(resp.Data.carrera);
                              $("#input-Facultad-t1").html(resp.Data.facultad);
                      }else if(tipoPerson == 'EMPLEADO'){
                          $("#data-user-t1").html('<div class="item-data-user">'+
                              '<p class="data-value">Estado</p>'+
                              '<p class="data-value" id="input-estado-t1">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Puesto</p>'+
                              '<p class="data-value" id="input-puesto-t1">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Departamento</p>'+
                              '<p class="data-value" id="input-departamento-t1">cargando..</p>'+
                              '</div>');

                          $("#photo-alumno-t1").attr("src","https://academico.um.edu.mx/academico/foto?Codigo=" + resp.Data.codigo_personal);
                          $("#name-alumno-t1").html(resp.Data.nombre);
                          $("#input-Matricula-t1").html(resp.Data.codigo_personal);
                          if(resp.Data.status == 'A'){
                              $("#input-estado-t1").html('ACTIVO');
                          }else{
                              $("#input-estado-t1").html('iNACTIVO');
                          }

                          $("#input-puesto-t1").html(resp.Data.puesto);
                          $("#input-departamento-t1").html(resp.Data.departamento);
                      }
                  }
              });
              }
              if(updateViews[1] == 1){
                  $.ajax({
                  url:"/lastRegistro/{{$EntradaLoc==''?'ARCO_PRINCIPAL':$EntradaLoc}}/"+ codeP.Data[0].torn2Reg,
                  dataType : 'text',
                  success: function (response) {
                      var resp = jQuery.parseJSON(response);
                      var tipoPerson = resp.Data.tipo_persona;
                      if(tipoPerson == 'ALUMNO'){
                          $("#data-user-t2").html('<div class="item-data-user">'+
                              '<p class="data-value">Permiso</p>'+
                              '<p class="data-value" id="input-Permiso-t2">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Residencia</p>'+
                              '<p class="data-value" id="input-Residencia-t2">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Estado</p>'+
                              '<p class="data-value" id="input-Estado-t2">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Facultad</p>'+
                              '<p class="data-value" id="input-Facultad-t2">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Carrerar</p>'+
                              '<p class="data-value" id="input-Carrera-t2">cargando..</p>'+
                              '</div>');

                              $("#photo-alumno-t2").attr("src","https://academico.um.edu.mx/academico/foto?Codigo=" + resp.Data.codigo_personal);
                              $("#name-alumno-t2").html(resp.Data.nombre);
                              $("#input-Matricula-t2").html(resp.Data.codigo_personal);
                              $("#input-Residencia-t2").html(resp.Data.residencia);
                              $("#input-Estado-t2").html(resp.Data.status);
                              $("#input-Carrera-t2").html(resp.Data.carrera);
                              $("#input-Facultad-t2").html(resp.Data.facultad);
                      }else if(tipoPerson == 'EMPLEADO'){
                          $("#data-user-t2").html('<div class="item-data-user">'+
                              '<p class="data-value">Estado</p>'+
                              '<p class="data-value" id="input-estado-t2">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Puesto</p>'+
                              '<p class="data-value" id="input-puesto-t2">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Departamento</p>'+
                              '<p class="data-value" id="input-departamento-t2">cargando..</p>'+
                              '</div>');

                          $("#photo-alumno-t2").attr("src","https://academico.um.edu.mx/academico/foto?Codigo=" + resp.Data.codigo_personal);
                          $("#name-alumno-t2").html(resp.Data.nombre);
                          $("#input-Matricula-t2").html(resp.Data.codigo_personal);
                          if(resp.Data.status == 'A'){
                              $("#input-estado-t2").html('ACTIVO');
                          }else{
                              $("#input-estado-t2").html('iNACTIVO');
                          }

                          $("#input-puesto-t2").html(resp.Data.puesto);
                          $("#input-departamento-t2").html(resp.Data.departamento);
                      }
                  }
              });
              }
              if(updateViews[2] == 1){
                  $.ajax({
                  url:"/lastRegistro/{{$EntradaLoc==''?'ARCO_PRINCIPAL':$EntradaLoc}}/"+ codeP.Data[0].torn3Reg,
                  dataType : 'text',
                  success: function (response) {
                      var resp = jQuery.parseJSON(response);
                      var tipoPerson = resp.Data.tipo_persona;
                      if(tipoPerson == 'ALUMNO'){
                          $("#data-user-t3").html('<div class="item-data-user">'+
                              '<p class="data-value">Permiso</p>'+
                              '<p class="data-value" id="input-Permiso-t3">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Residencia</p>'+
                              '<p class="data-value" id="input-Residencia-t3">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Estado</p>'+
                              '<p class="data-value" id="input-Estado-t3">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Facultad</p>'+
                              '<p class="data-value" id="input-Facultad-t3">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Carrerar</p>'+
                              '<p class="data-value" id="input-Carrera-t3">cargando..</p>'+
                              '</div>');

                              $("#photo-alumno-t3").attr("src","https://academico.um.edu.mx/academico/foto?Codigo=" + resp.Data.codigo_personal);
                              $("#name-alumno-t3").html(resp.Data.nombre);
                              $("#input-Matricula-t3").html(resp.Data.codigo_personal);
                              $("#input-Residencia-t3").html(resp.Data.residencia);
                              $("#input-Estado-t3").html(resp.Data.status);
                              $("#input-Carrera-t3").html(resp.Data.carrera);
                              $("#input-Facultad-t3").html(resp.Data.facultad);
                      }else if(tipoPerson == 'EMPLEADO'){
                          $("#data-user-t3").html('<div class="item-data-user">'+
                              '<p class="data-value">Estado</p>'+
                              '<p class="data-value" id="input-estado-t3">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Puesto</p>'+
                              '<p class="data-value" id="input-puesto-t3">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Departamento</p>'+
                              '<p class="data-value" id="input-departamento-t3">cargando..</p>'+
                              '</div>');

                          $("#photo-alumno-t3").attr("src","https://academico.um.edu.mx/academico/foto?Codigo=" + resp.Data.codigo_personal);
                          $("#name-alumno-t3").html(resp.Data.nombre);
                          $("#input-Matricula-t3").html(resp.Data.codigo_personal);
                          if(resp.Data.status == 'A'){
                              $("#input-estado-t3").html('ACTIVO');
                          }else{
                              $("#input-estado-t3").html('iNACTIVO');
                          }

                          $("#input-puesto-t3").html(resp.Data.puesto);
                          $("#input-departamento-t3").html(resp.Data.departamento);
                      }
                  }
              });
              }
              if(updateViews[3] == 1){
                  $.ajax({
                  url:"/lastRegistro/{{$EntradaLoc==''?'ARCO_PRINCIPAL':$EntradaLoc}}/"+ codeP.Data[0].bandera,
                  dataType : 'text',
                  success: function (response) {
                      var resp = jQuery.parseJSON(response);
                      var tipoPerson = resp.Data.tipo_persona;
                      if(tipoPerson == 'ALUMNO'){
                          $("#data-user-bandera").html('<div class="item-data-user">'+
                              '<p class="data-value">Permiso</p>'+
                              '<p class="data-value" id="input-Permiso-bandera">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Residencia</p>'+
                              '<p class="data-value" id="input-Residencia-bandera">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Estado</p>'+
                              '<p class="data-value" id="input-Estado-bandera">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Facultad</p>'+
                              '<p class="data-value" id="input-Facultad-bandera">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Carrerar</p>'+
                              '<p class="data-value" id="input-Carrera-bandera">cargando..</p>'+
                              '</div>');

                              $("#photo-alumno-bandera").attr("src","https://academico.um.edu.mx/academico/foto?Codigo=" + resp.Data.codigo_personal);
                              $("#name-alumno-bandera").html(resp.Data.nombre);
                              $("#input-Matricula-bandera").html(resp.Data.codigo_personal);
                              $("#input-Residencia-bandera").html(resp.Data.residencia);
                              $("#input-Estado-bandera").html(resp.Data.status);
                              $("#input-Carrera-bandera").html(resp.Data.carrera);
                              $("#input-Facultad-bandera").html(resp.Data.facultad);
                      }else if(tipoPerson == 'EMPLEADO'){
                          $("#data-user-bandera").html('<div class="item-data-user">'+
                              '<p class="data-value">Estado</p>'+
                              '<p class="data-value" id="input-estado-bandera">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Puesto</p>'+
                              '<p class="data-value" id="input-puesto-bandera">cargando..</p>'+
                              '</div>'+
                              '<div class="item-data-user">'+
                              '<p class="data-value">Departamento</p>'+
                              '<p class="data-value" id="input-departamento-bandera">cargando..</p>'+
                              '</div>');

                          $("#photo-alumno-bandera").attr("src","https://academico.um.edu.mx/academico/foto?Codigo=" + resp.Data.codigo_personal);
                          $("#name-alumno-bandera").html(resp.Data.nombre);
                          $("#input-Matricula-bandera").html(resp.Data.codigo_personal);
                          if(resp.Data.status == 'A'){
                              $("#input-estado-bandera").html('ACTIVO');
                          }else{
                              $("#input-estado-bandera").html('iNACTIVO');
                          }

                          $("#input-puesto-bandera").html(resp.Data.puesto);
                          $("#input-departamento-bandera").html(resp.Data.departamento);
                      }
                  }
              });
              }
              updateViews = [0,0,0,0];
          }

          function checkLastReg(){
              $.ajax({
                  url:"/checkLastRegistro/{{$EntradaLoc==""?"ARCO_PRINCIPAL":$EntradaLoc}}",
                  dataType : 'text',
                  success: function (response) {
                      var resp = jQuery.parseJSON(response);
                      var torn1 = resp.Data[0].torn1Reg;
                      var torn2 = resp.Data[0].torn2Reg;
                      var torn3 = resp.Data[0].torn3Reg;
                      var bandera = resp.Data[0].bandera;

                      if(torn1 != torn1RegBefore){
                          torn1RegBefore = torn1;
                          updateViews[0] = 1;
                      }else{
                          updateViews[0] = 0;
                      }

                      if(torn2 != torn2RegBefore){
                          torn2RegBefore = torn2;
                          updateViews[1] = 1;
                      }else{
                          updateViews[1] = 0;
                      }

                      if(torn3 != torn3RegBefore){
                          torn3RegBefore = torn3;
                          updateViews[2] = 1;
                      }else{
                          updateViews[2] = 0;
                      }

                      if(bandera != banderaBefore){
                          banderaBefore = bandera;
                          updateViews[3] = 1;
                      }else{
                          updateViews[3] = 0;
                      }

                      updateView(response,updateViews)
                  }
              });
          }
          setInterval(checkLastReg,8000);
      })
    </script>
  </body>
</html>
